"use strict";(self.webpackChunkfeed_specification=self.webpackChunkfeed_specification||[]).push([[8650],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var d=a.createContext({}),o=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=o(e.components);return a.createElement(d.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,d=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=o(n),c=l,u=m["".concat(d,".").concat(c)]||m[c]||f[c]||i;return n?a.createElement(u,r(r({ref:t},p),{},{components:n})):a.createElement(u,r({ref:t},p))}));function c(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=m;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:l,r[1]=s;for(var o=2;o<i;o++)r[o]=n[o];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},46215:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>f,frontMatter:()=>i,metadata:()=>s,toc:()=>o});var a=n(87462),l=(n(67294),n(3905));const i={sidebar_position:2},r="Delta Feeds",s={unversionedId:"types-of-feeds/pull/delta-feeds",id:"types-of-feeds/pull/delta-feeds",title:"Delta Feeds",description:"Delta feeds is a way of splitting up your inventory to a base feed and then periodically supplying small files with only the changes. This improves the amount of offers and the average time for offer updates by just sending the information changed.",source:"@site/docs/types-of-feeds/pull/delta-feeds.md",sourceDirName:"types-of-feeds/pull",slug:"/types-of-feeds/pull/delta-feeds",permalink:"/types-of-feeds/pull/delta-feeds",draft:!1,editUrl:"https://github.com/Prisjakt/feed-specification/tree/master/docs/types-of-feeds/pull/delta-feeds.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Pull",permalink:"/types-of-feeds/pull/"},next:{title:"Feeds",permalink:"/types-of-feeds/pull/feed"}},d={},o=[{value:"Advantages",id:"advantages",level:2},{value:"Disadvantages",id:"disadvantages",level:2},{value:"Base Feed",id:"base-feed",level:2},{value:"Index File",id:"index-file",level:2},{value:"Expected File Structure",id:"expected-file-structure",level:2},{value:"Delta File",id:"delta-file",level:2},{value:"Flow",id:"flow",level:2}],p={toc:o};function f(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"delta-feeds"},"Delta Feeds"),(0,l.kt)("p",null,"Delta feeds is a way of splitting up your inventory to a base feed and then periodically supplying small files with only the changes. This improves the amount of offers and the average time for offer updates by just sending the information changed."),(0,l.kt)("p",null,"Delta files can be read at a higher frequency and contains a ",(0,l.kt)("a",{parentName:"p",href:"/fields/offer/delta_command"},"delta_command")," plus changed fields for each offer."),(0,l.kt)("p",null,"Delta feeds consists of three components:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Index file")," a list that specifies that delta files exist and when they where updated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Base feed")," this is the full inventory feed with all offers and all information, read at a slower pace"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Delta files")," small files generated often that contains a ",(0,l.kt)("a",{parentName:"li",href:"/fields/offer/delta_command"},"delta_command")," plus changes only")),(0,l.kt)("h2",{id:"advantages"},"Advantages"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Can handle large volumes (> millions of offers)"),(0,l.kt)("li",{parentName:"ul"},"Average time for price update is low")),(0,l.kt)("h2",{id:"disadvantages"},"Disadvantages"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Complex for to setup since it requires work on webserver to produce delta files")),(0,l.kt)("h2",{id:"base-feed"},"Base Feed"),(0,l.kt)("p",null,"The base feed should contain full inventory and full offer inventory and be generated once per week."),(0,l.kt)("h2",{id:"index-file"},"Index File"),(0,l.kt)("p",null,"The file index is a way for us to get an overview from you what changes exist since our last poll. This should be reset once every week when the ",(0,l.kt)("a",{parentName:"p",href:"#base-feed"},"base feed")," is re-generated."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<?xml version='1.0' encoding='UTF-8'?>\n<delta_feed>\n  <base_file>2023-01-12-base.xml</base_file>\n  <delta_files>\n    <item>\n      <filename>2023-01-12-delta-1.xml</filename>\n\n      \x3c!--iso 8601 timestamp--\x3e\n      <updated_timestamp>2023-01-12T10:17:30+01:00</updated_timestamp>\n    </item>\n    <item>\n      <filename>2023-01-12-delta-2.xml</filename>\n      <updated_timestamp>2023-01-12T11:17:30+01:00</updated_timestamp>\n    </item>\n    <item>\n      <filename>2023-01-12-delta-3.xml</filename>\n      <updated_timestamp>2023-01-12T12:17:30+01:00</updated_timestamp>\n    </item>\n\n    \x3c!--file list continues as new delta files gets created --\x3e\n\n  </delta_files>\n</delta_feed>  \n")),(0,l.kt)("h2",{id:"expected-file-structure"},"Expected File Structure"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Index file always have the same name: ",(0,l.kt)("inlineCode",{parentName:"li"},"index-file.xml")),(0,l.kt)("li",{parentName:"ul"},"Base feed should follow pattern ",(0,l.kt)("inlineCode",{parentName:"li"},"yyyy-MM-dd-base.xml")," with the date it was generated"),(0,l.kt)("li",{parentName:"ul"},"Delta files should follow pattern ",(0,l.kt)("inlineCode",{parentName:"li"},"yyyy-MM-dd-delta-X.xml")," where date is the ",(0,l.kt)("strong",{parentName:"li"},"date of the base feed")," the delta file belongs to and ",(0,l.kt)("inlineCode",{parentName:"li"},"X")," is an increasing counter")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"\u251c\u2500\u2500 2023-01-12-base.xml\n\u251c\u2500\u2500 2023-01-12-delta-1.xml\n\u251c\u2500\u2500 2023-01-12-delta-2.xml\n\u251c\u2500\u2500 2023-01-12-delta-3.xml\n\u2514\u2500\u2500 index-file.xml\n")),(0,l.kt)("h2",{id:"delta-file"},"Delta File"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<rss xmlns:pj="https://schema.prisjakt.nu/ns/1.0" xmlns:g="http://base.google.com/ns/1.0" version="3.0">\n  <channel>\n    <title>Prisjakt Delta File</title>\n    <description>This is an example delta file which updates partial data</description>\n    <link>https://schema.prisjakt.nu</link>\n\n\n    \x3c!-- Update sale_price and sale_price_effective_date on an offer --\x3e\n    <item>\n      <pj:delta_command>upsert</pj:delta_command>\n      <g:id><![CDATA[213888]]></g:id>\n      <g:sale_price>89.99 SEK</g:sale_price>\n      <g:sale_price_effective_date>2016-02-24T13:00:00-08:00/2016-02-29T15:30:00+02:00</g:sale_price_effective_date>\n    </item>\n\n    \x3c!-- Remove an offer --\x3e\n    <item>\n      <pj:delta_command>remove</pj:delta_command>\n      <g:id><![CDATA[12345]]></g:id>\n    </item>\n\n    \x3c!-- Insert new --\x3e\n    <item>\n      <g:delta_command>upsert</g:delta_command>\n      <g:condition>new</g:condition>\n      <g:google_product_category>1144</g:google_product_category>\n      <g:id><![CDATA[213889]]></g:id>\n      <g:link>http://example.com/link</g:link>\n      <g:price>99.99 SEK</g:price>\n      <g:title><![CDATA[Samsung Galaxy S8 Black 128G]]></g:title>\n    </item>\n\n  </channel>\n</rss>\n')),(0,l.kt)("h2",{id:"flow"},"Flow"),(0,l.kt)("mermaid",{value:"%%{init: {'theme':'neutral'}}%%\nsequenceDiagram\n    participant A as Prisjakt Agent\n    participant S as Delta Scheduler\n    participant F as Your Web Server\n\n    S->>F: Reads Index every 5 minutes\n    F->>S: Responds with a list of urls \n    note over F,S: List contains multiple delta files \n    note over F,S: May change between requests (delta feeds added)\n\n    alt If full read should be done\n        note over S,A: Full read happens first time + once every week\n        S->>A: Initiates ingestion\n        A->>F: Requests Full Feed From <Base Url>\n        F->>A: Responds With Feed\n        A->>A: Ingests Feed\n    else If delta file read should be done\n        loop For each delta file\n            S->>A: Initiates ingestion\n            A->>A: Retrieves last stored delta number and timestamp\n            A->>F: Requests next delta file\n            F->>A: Responds with delta feefile\n            A->>A: Ingests delta file updates\n            A->>A: Stores last ingested delta number and timestamp\n        end\n    end"}))}f.isMDXComponent=!0}}]);